# プロキシチェックツール

Googleスプレッドシートからプロキシを読み込み、有効性をチェックして結果を書き込むツールです。

## 機能

- Googleスプレッドシートからプロキシリストを読み込み
- 各プロキシの有効性を自動チェック（厳密モード対応）
- チェック結果（有効/無効、エラーメッセージ）をスプレッドシートに書き込み
- **チェック日時の記録**: 最後にチェックした日時を自動記録
- **変更追跡**: 前回有効だったプロキシが無効になった場合を自動検出
- **定期的な自動チェック**: Windowsタスクスケジューラで定期実行可能

## セットアップ

### 1. 依存パッケージのインストール

```bash
pip install -r requirements.txt
```

### 2. Googleサービスアカウントの設定

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. 新しいプロジェクトを作成（または既存のプロジェクトを選択）
3. 「APIとサービス」→「ライブラリ」から「Google Sheets API」と「Google Drive API」を有効化
4. 「認証情報」→「認証情報を作成」→「サービスアカウント」を選択
5. サービスアカウントを作成し、JSONキーをダウンロード
6. ダウンロードしたJSONファイルをプロジェクトフォルダに配置

### 3. スプレッドシートの設定

1. 新しいGoogleスプレッドシートを作成
2. スプレッドシートのURLからキーを取得
   - URL例: `https://docs.google.com/spreadsheets/d/SPREADSHEET_KEY/edit`
   - `SPREADSHEET_KEY`の部分がスプレッドシートキーです
3. スプレッドシートの共有設定で、サービスアカウントのメールアドレスに「編集者」権限を付与
4. スプレッドシートの1行目にヘッダーを設定（例: A列「プロキシ」、B列「ステータス」、C列「メッセージ」）
5. A列にプロキシを入力（2行目以降）

### プロキシの形式

以下の形式でプロキシを入力してください：

- `IP:PORT:USERNAME:PASSWORD` （例: `195.40.120.108:5791:mqorpvdn:xecexepqtekp`）
- `http://host:port`
- `http://user:pass@host:port`
- `https://host:port`
- `https://user:pass@host:port`

**注意**: `IP:PORT:USERNAME:PASSWORD`形式は自動的に`http://USERNAME:PASSWORD@IP:PORT`形式に変換されます。

## 使用方法

### GUI版（推奨）

GUIアプリケーションを使用する場合：

```bash
python proxy_checker_gui.py
```

GUIアプリケーションでは：
- 設定を視覚的に入力・編集可能
- リアルタイムでログと進捗を確認
- 設定ファイルの保存・読み込みが可能

### コマンドライン版

#### 設定ファイルを使用する場合（推奨）

1. `config.example.json`を`config.json`にコピー
2. 設定ファイルに必要な情報を入力
3. 以下のコマンドで実行：

```bash
python proxy_checker.py --config config.json
```

### コマンドライン引数を使用する場合

```bash
python proxy_checker.py \
  --credentials credentials.json \
  --spreadsheet-key YOUR_SPREADSHEET_KEY \
  --worksheet Sheet1 \
  --proxy-column A \
  --status-column B \
  --message-column C \
  --start-row 2 \
  --delay 1.0
```

### 設定ファイルとコマンドライン引数の併用

コマンドライン引数は設定ファイルの値を上書きします：

```bash
python proxy_checker.py --config config.json --delay 2.0
```

### 引数の説明

- `--credentials` / `-c`: Googleサービスアカウントの認証情報JSONファイルパス（必須）
- `--spreadsheet-key` / `-k`: スプレッドシートのキー（必須）
- `--worksheet` / `-w`: ワークシート名（デフォルト: Sheet1）
- `--proxy-column` / `-pc`: プロキシが記載されている列（デフォルト: A）
- `--status-column` / `-sc`: ステータスを書き込む列（デフォルト: B）
- `--message-column` / `-mc`: メッセージを書き込む列（デフォルト: C）
- `--start-row` / `-sr`: データが開始する行番号（デフォルト: 2）
- `--delay` / `-d`: チェック間の遅延秒数（デフォルト: 1.0）

## スプレッドシートのレイアウト例

| プロキシ | ステータス | メッセージ |
|---------|-----------|-----------|
| http://proxy1.example.com:8080 | 有効 | 成功: {...} |
| http://proxy2.example.com:8080 | 無効 | タイムアウト |
| http://user:pass@proxy3.example.com:8080 | 有効 | 成功: {...} |

## 注意事項

- プロキシチェックには時間がかかるため、大量のプロキシをチェックする場合は`--delay`オプションで適切な遅延を設定してください
- スプレッドシートへの書き込み権限がサービスアカウントに付与されていることを確認してください
- プロキシのチェックには`httpbin.org`を使用しています。必要に応じてコード内の`test_url`を変更してください

## 定期的な自動チェック

Windowsタスクスケジューラを使用して、定期的にプロキシを自動チェックできます。

### 設定方法

詳細な設定手順は `setup_schedule.md` を参照してください。

### 簡単な設定手順

1. `schedule_check.bat` をWindowsタスクスケジューラに登録
2. 実行頻度を設定（例: 毎日午前9時）
3. 自動的にチェックが実行され、無効になったプロキシが検出されます

### ログ

- **通常ログ**: `schedule_log.txt` に記録
- **エラーログ**: 無効になったプロキシが検出された場合、`schedule_error_log.txt` に記録

### スプレッドシートの列構成

自動チェック機能を使用する場合、以下の列が自動的に追加されます：

- **A列**: プロキシ
- **B列**: ステータス（有効/無効）
- **C列**: メッセージ（詳細情報）
- **D列**: チェック日時（最後にチェックした日時）
- **E列**: 前回ステータス（前回のチェック時のステータス）

## トラブルシューティング

### 認証エラーが発生する場合

- サービスアカウントのJSONファイルのパスが正しいか確認
- スプレッドシートにサービスアカウントのメールアドレスが共有されているか確認

### プロキシが読み込めない場合

- スプレッドシートキーが正しいか確認
- ワークシート名が正しいか確認
- プロキシ列の指定が正しいか確認

### 書き込みエラーが発生する場合

- サービスアカウントに編集権限が付与されているか確認
- 列の指定が正しいか確認
